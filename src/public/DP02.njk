{%- extends "_templates/_layout.njk" -%}

{% block content %}

<script>
// 달력 js 
function fn_datapicker() {
  const isMobile = window.innerWidth <= 768;

  document.querySelectorAll('.year-picker-input, .month-picker-input, .day-picker-input')
    .forEach(function (input) {
      const type = input.dataset.type;

      // PC 버전
      if (!isMobile) {
        let options = {
          inline: true,
          view: type === 'year' ? 'years' : type === 'month' ? 'months' : 'days',
          minView: type === 'year' ? 'years' : type === 'month' ? 'months' : 'days',
          dateFormat: type === 'year' ? 'yyyy' :
                      type === 'month' ? 'yyyy.MM' : 'yyyy.MM',
          firstDay: 0,
          navTitles: { days: '<i>yyyy</i>.MMMM' },
          onSelect({ date }) {
            if (!date) {
              input.value = '';
              return;
            }
            if (type === 'year') {
              input.value = date.getFullYear();
            } else if (type === 'month') {
              const m = date.getMonth() + 1;
              input.value = `${date.getFullYear()}.${m < 10 ? '0' + m : m}`;
            } else {
              const m = date.getMonth() + 1;
              const d = date.getDate();
              input.value = `${date.getFullYear()}.${m < 10 ? '0' + m : m}.${d < 10 ? '0' + d : d}`;
            }
          }
        };

        new AirDatepicker(input, options);

        const pickerEl = input.parentNode.querySelector('.air-datepicker.-inline-');
        if (pickerEl) {
          input.closest('.input-picker').insertAdjacentElement('afterend', pickerEl);
        }
      } 
      
      // 모바일
      else {
        const modal = document.querySelector('#picker-mo');
        const pickerWrap = modal.querySelector('.mo-picker-wrap');
        const closeBtn = modal.querySelector('.modal-close');

        input.addEventListener('click', function () {
          modal.style.display = 'block';
          pickerWrap.innerHTML = ''; // 이전 달력 제거

          // 📌 모달 안에 달력을 붙일 dummy element 생성
          const dummyDiv = document.createElement('div');
          pickerWrap.appendChild(dummyDiv);

          // 모달 안에서 달력 생성
          new AirDatepicker(dummyDiv, {
            inline: true,
            view: type === 'year' ? 'years' : type === 'month' ? 'months' : 'days',
            minView: type === 'year' ? 'years' : type === 'month' ? 'months' : 'days',
            dateFormat: type === 'year' ? 'yyyy' :
                        type === 'month' ? 'yyyy.MM' : 'yyyy.MM',
            firstDay: 0,
            navTitles: { days: '<i>yyyy</i>.MMMM' },
            selectedDates: input.value ? [input.value] : [], // 기존 값 있으면 선택 반영
            onSelect({ date }) {
              if (!date) {
                input.value = '';
              } else if (type === 'year') {
                input.value = date.getFullYear();
              } else if (type === 'month') {
                const m = date.getMonth() + 1;
                input.value = `${date.getFullYear()}.${m < 10 ? '0' + m : m}`;
              } else {
                const m = date.getMonth() + 1;
                const d = date.getDate();
                input.value = `${date.getFullYear()}.${m < 10 ? '0' + m : m}.${d < 10 ? '0' + d : d}`;
              }
              modal.style.display = 'none';
            }
          });
        });

        closeBtn.addEventListener('click', function () {
          modal.style.display = 'none';
        });
      }
    });
}

document.addEventListener('DOMContentLoaded', fn_datapicker);
</script>

<div class="content page-polio">
    <div class="content-head-btn">
        <div class="content-head">
            <h1 class="headline1">데이터폴리오</h1>
            <p class="head-guidetext">원하는 조건을 선택하면 맞춤형 데이터를 생성해드려요.</p>
        </div>
        <!-- 250818 임시저장 버튼 수정-->
        <div class="button-box-small">
            <button type="button" class="btn-ts">임시저장</button>
            <button type="button" class="count">7</button>
        </div>
        <!-- //250818 임시저장 버튼 수정-->
    </div>            

    <div class="datapolio-search">
        <div class="input-box">
            <input type="text" class="ipt" placeholder="조건을 입력하면 AI가 자동 선택해드려요.">
            <span class="util-box">
                <button type="button" class="ipt-search"><i>검색</i></button>
            </span>
        </div>
        <!-- 결과대기중 :is-ai-->
        <div class="input-box is-ai">
            <input type="text" class="ipt" placeholder="조건을 입력하면 AI가 자동 선택해드려요." value="조건을 입력하면 AI가 자동 선택해드려요">
            <span class="util-box">
                <button type="button" class="ipt-search"><i>검색</i></button>
            </span>
        </div>
        <!-- 결과대기중 -->
    </div>

    <div class="datapolio-contents">
        <div class="content-step">
            <ul>
                <li class="on">
                    <i class="bar"></i>
                    <div class="step-title">
                        <em class="step-bedge">필수</em>
                        <em class="step-txt">데이터유형</em>
                    </div>
                </li>
                <li class="on">
                    <i class="bar"></i>
                    <div class="step-title">
                        <em class="step-bedge">필수</em>
                        <em class="step-txt">기간</em>
                    </div>
                </li>
                <li>
                    <i class="bar"></i>
                    <div class="step-title">
                        <em class="step-bedge">필수</em>
                        <em class="step-txt">지역</em>
                    </div>
                </li>
                <li>
                    <i class="bar"></i>
                    <div class="step-title">
                        <em class="step-bedge">필수</em>
                        <em class="step-txt">업종</em>
                    </div>
                </li>
                <li>
                    <i class="bar"></i>
                    <div class="step-title">
                        <em class="step-txt">세부항목</em>
                    </div>
                </li>
            </ul>
        </div>

        <div class="step-content">
            <p class="title3">어떤 기준으로 기간 데이터를 만들까요?</p>
            <div class="chip-box chip-box-large">
                <label class="chip"><input type="radio" name="radio1" checked=""><i>연도별</i></label>
                <label class="chip"><input type="radio" name="radio1"><i>월별</i></label>
                <label class="chip"><input type="radio" name="radio1"><i>일별</i></label>
            </div>
            <!-- 연도별 -->
            <div class="picker-wrap">
                <div class="picker-s">
                    <label class="picker-tit" for="year-picker-s">시작 년도</label>
                    <div class="input-picker">
                        <div class="input-box is-error"><!--error : is-error-->
                            <input type="text" class="ipt year-picker-input" id="year-picker-s" data-type="year" placeholder="YYYY" >
                        </div>
                        <p class="input-help is-error">날짜를 입력해 주세요.</p>
                    </div>
                </div>
                <div class="picker-e">
                    <label class="picker-tit" for="year-picker-e">종료 년도</label>
                    <div class="input-picker">
                        <div class="input-box is-error"><!--error : is-error-->
                            <input type="text" class="ipt year-picker-input" id="year-picker-e" data-type="year" placeholder="YYYY" >
                        </div>
                        <p class="input-help is-error">날짜를 입력해 주세요.</p>
                    </div>
                </div>
            </div>
            <!-- //연도별 -->
            <!-- 월별 -->
            <div class="picker-wrap">
                <div class="picker-s">
                    <label class="picker-tit" for="month-picker-s">시작 월</label>
                    <div class="input-picker">
                        <div class="input-box">
                            <input type="text" class="ipt month-picker-input" id="month-picker-s" data-type="month" placeholder="YYYY.MM" >
                        </div>
                    </div>
                </div>
                <div class="picker-e">
                    <label class="picker-tit" for="month-picker-e">종료 월</label>
                    <div class="input-picker">
                        <div class="input-box">
                            <input type="text" class="ipt month-picker-input" id="month-picker-e" data-type="month" placeholder="YYYY.MM" >
                        </div>
                    </div>
                </div>
            </div>
            <!-- //월별 -->
            <!-- 일별 -->
            <div class="picker-wrap">
                <div class="picker-s">
                    <label class="picker-tit" for="day-picker-s">시작 날짜</label>
                    <div class="input-picker">
                        <div class="input-box">
                            <input type="text" class="ipt day-picker-input" id="day-picker-s" data-type="day" placeholder="YYYY.MM.DD" >
                        </div>
                    </div>
                </div>
                <div class="picker-e">
                    <label class="picker-tit" for="day-picker-e">종료 날짜</label>
                    <div class="input-picker">
                        <div class="input-box">
                            <input type="text" class="ipt day-picker-input" id="day-picker-e" data-type="day" placeholder="YYYY.MM.DD" >
                        </div>
                    </div>
                </div>
            </div>
            <!-- //일별 -->
        </div>
    </div>

    <div class="datapolio-bottom">
    <div class="btn-filter">
        <button type="button" class="btn-icon-filter is-filter">
            <i>선택조건 있음</i>
        </button>
    </div>
    <div class="filter_box">
        <div class="filter-content">
            <span class="filter-tit">선택한 조건</span>
            
            <!-- 선택한 조건 있을 경우 -->
            <button type="button" class="filter-reset">초기화</button>
            <div class="filter-option item-scroll-wrap">
                <div class="option-box">
                    <span class="option-tit">데이터유형 <em class="count">1</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>내국인 카드소비 데이터</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">기간 <em class="count">1</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>2024</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                        <div class="option-txt is-ai">
                            <span>2024</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                        <div class="option-txt">
                            <span>내국인 카드소비 데이터</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">지역 <em class="count">2</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>서울특별시 강남구 논현동</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                        <div class="option-txt">
                            <span>서울특별시 강남구 청담동</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">업종 <em class="count">2</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>가정통신 > 가전 > 건강가전</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                        <div class="option-txt is-ai">
                            <span>가정통신 > 가전 > 건강가전</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">요일 <em class="count">2</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>주말</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">시간대 <em class="count">2</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>저녁</span>
                            <button type="but                                     on" class="del">삭제</button>
                        </div>
                    </div>
                </div>
                <div class="option-box">
                    <span class="option-tit">연령 <em class="count">2</em></span>
                    <div class="option-filter-box">
                        <div class="option-txt is-ai">
                            <span>20대</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                        <div class="option-txt is-ai">
                            <span>30대</span>
                            <button type="button" class="del">삭제</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- //선택한 조건 있을 경우 -->
            <!-- 선택한 조건 없을 경우 -->
            <button type="button" class="filter-reset disabled">초기화</button>
            <div class="result-none">
                <p class="message">선택한 조건이 없어요</p>
            </div>
            <!-- //선택한 조건 없을 경우 -->
            <button class="filter-close" type="button">닫기</button>
        </div>
    </div>
    <div class="bottom-content">
        <div class="polio-quote">
            <div class="quote-box">
                <div class="quote-tit">
                    <span class="tit">견적</span>
                    <span class="sub">(VAT 포함)</span>
                    <button type="button" class="detail-info"><i class="icon-info-s">세부정보</i></button>
                </div>
                <div class="quote-result">
                    <span class="price">
                        <i>0</i>원
                    </span>
                    <span class="my-price">(나의 예상 구매 가격 <i>139,570,000</i>원)</span>
                </div>
            </div>
            <div class="textbutton-box-xsmall">
                <a href="#" class="textbutton-p underline disabled">샘플데이터 확인</a>
            </div>
        </div> 
        <div class="button-box-large">
            <button class="button-q" type="button">이전</button>
            <button class="button-p" type="button">다음</button>
        </div>
    </div>
    </div>
    
</div> 
{%- endblock %}   
{% block modal %}
<div class="pop-modal picker-model" id="picker-mo" style="display:none">
    <div class="modal modal-large" tabindex="0">
        <div class="modal-header">날짜 선택</div>
        <div class="mo-picker-wrap"></div>
        <button class="modal-close" type="button">닫기</button>
    </div>
</div>
{%- endblock %}                

